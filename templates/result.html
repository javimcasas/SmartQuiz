{% extends "base.html" %}

{% block title %}Result Â· {{ exam.title }}{% endblock %}

{% block content %}
  <div class="mb-6">
    <a href="/" class="text-sm text-muted-foreground hover:text-foreground">&larr; Back to exams</a>
  </div>

  <div class="mb-4">
    <h1 class="text-2xl font-semibold tracking-tight">Result</h1>
    <p class="mt-1 text-sm text-muted-foreground">{{ exam.title }}</p>
  </div>

  <div class="grid gap-4 md:grid-cols-3 mb-6">
    <div class="rounded-xl border border-border bg-muted/60 p-4">
      <p class="text-xs uppercase tracking-wide text-muted-foreground">Points</p>
      <p class="mt-1 text-xl font-semibold text-foreground">
        {{ result.total_points }}/{{ result.max_points }}
      </p>
    </div>
    <div class="rounded-xl border border-border bg-muted/60 p-4">
      <p class="text-xs uppercase tracking-wide text-muted-foreground">Percentage</p>
      <p class="mt-1 text-xl font-semibold text-foreground">
        {{ '%.2f' % result.percentage }}%
      </p>
    </div>
    <div class="rounded-xl border border-border bg-muted/60 p-4">
      <p class="text-xs uppercase tracking-wide text-muted-foreground">Questions</p>
      <p class="mt-1 text-xl font-semibold text-foreground">
        {{ n_correct }}/{{ n_total }}
      </p>
    </div>
  </div>

  <div class="space-y-3">
    {% for qr in result.per_question %}
      <section class="rounded-xl border border-border bg-muted/60 p-4">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 class="text-sm font-semibold text-foreground">
              Q{{ qr.question_number }}
            </h2>
            <p class="mt-1 text-xs text-muted-foreground">
              Points: {{ qr.gained_points }}/{{ qr.max_points }}
            </p>
          </div>
          <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium
                       {% if qr.is_correct %}
                         bg-emerald-500/10 text-emerald-400 border border-emerald-500/30
                       {% else %}
                         bg-rose-500/10 text-rose-400 border border-rose-500/30
                       {% endif %}">
            {% if qr.is_correct %}Correct{% else %}Incorrect{% endif %}
          </span>
        </div>

        <div class="mt-3 text-sm text-foreground space-y-1">
          <p>
            <span class="text-muted-foreground">Your answer:</span>
            {% if qr.user_answer %}
              <span class="ml-1">{{ ", ".join(qr.user_answer) }}</span>
            {% else %}
              <span class="ml-1 italic text-muted-foreground">(no answer)</span>
            {% endif %}
          </p>
          <p>
            <span class="text-muted-foreground">Correct:</span>
            <span class="ml-1">{{ ", ".join(qr.correct_answer) }}</span>
          </p>
        </div>
      </section>
    {% endfor %}
  </div>
{% endblock %}
