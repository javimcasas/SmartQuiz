<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{% block title %}SmartQuiz{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicon .ico dedicado -->
    <link rel="icon" type="image/x-icon" href="/static/images/SmartQuiz_favicon.ico" />

    <!-- Tailwind Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* ESTILOS CSS PERSONALIZADOS - SOLUCIN DEFINITIVA */
      .light {
        --background: 240 5% 98%;     /* slate-50 */
        --foreground: 216 34% 17%;   /* slate-900 */
        --border: 216 34% 84%;       /* slate-200 */
        --muted-foreground: 216 32.2% 46.1%; /* slate-500 */
        --accent: 216 34% 94%;       /* slate-100 */
        color-scheme: light;
      }
      
      .dark {
        --background: 222.2 84% 4.9%;    /* slate-900 */
        --foreground: 210 40% 98%;      /* slate-100 */
        --border: 217.2 32.6% 17.5%;    /* slate-800 */
        --muted-foreground: 215 20.2% 65.1%; /* slate-400 */
        --accent: 216 34% 17%;          /* slate-800/80 */
        color-scheme: dark;
      }
      
      /* Aplicar variables CSS a clases Tailwind */
      .bg-background { background-color: hsl(var(--background)); }
      .text-foreground { color: hsl(var(--foreground)); }
      .border-border { border-color: hsl(var(--border)); }
      .text-muted-foreground { color: hsl(var(--muted-foreground)); }
      .bg-accent { background-color: hsl(var(--accent)); }
      .hover\:bg-accent:hover { background-color: hsl(var(--accent)); }
      .bg-background\/80 { background-color: hsl(var(--background) / 0.8); }
      .border-border { border-color: hsl(var(--border)); }
    </style>
  </head>
  <body class="{% if request.cookies.get('theme') == 'light' %}light{% else %}dark{% endif %} min-h-screen bg-background text-foreground flex flex-col">
    
    <!-- HEADER CON NAVEGACIN COMPLETA -->
    <header class="border-b border-border bg-background/80 backdrop-blur">
      <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
        <!-- Lado izquierdo: Logo + Navegaci贸n -->
        <div class="flex items-center gap-4">
          <!-- Logo / Home -->
          <a href="/" class="flex items-center gap-3 p-1 -m-1 rounded-lg hover:bg-accent transition-all
             {% if request.path == '/' %}font-semibold underline decoration-foreground underline-offset-4{% else %}hover:underline{% endif %}">
            <img src="/static/images/SmartQuiz_Logo.jpg"
                 alt="SmartQuiz"
                 class="h-10 w-10 rounded-xl shadow-sm" />
            <span class="text-2xl font-semibold tracking-tight">SmartQuiz</span>
          </a>
          
          <!-- Bot贸n Completed Exams -->
          <a href="/completed" 
             class="relative px-3 py-1.5 text-sm font-medium rounded-lg border border-border hover:bg-accent transition-all group shadow-sm
                    {% if request.path == '/completed' or request.path.startswith('/completed/') %}
                      bg-accent text-foreground font-semibold ring-1 ring-border shadow-md
                    {% else %}
                      text-muted-foreground hover:text-foreground hover:shadow-md
                    {% endif %}">
            Completed
            <!-- Contador din谩mico -->
            <span id="completed-badge" class="absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center text-xs bg-rose-500 text-white rounded-full px-1.5 shadow-lg hidden font-medium">
              0
            </span>
          </a>

          <!--  NUEVO: Generate Exams (IA) -->
          <a href="/generate" 
             class="relative px-3 py-1.5 text-sm font-medium rounded-lg border border-border hover:bg-accent transition-all group shadow-sm flex items-center gap-1.5
                    {% if request.path == '/generate' %}
                      bg-gradient-to-r from-purple-500/10 to-pink-500/10 text-purple-400 border-purple-500/30 font-semibold ring-1 ring-purple-500/30 shadow-md
                    {% else %}
                      text-muted-foreground hover:text-foreground hover:shadow-md
                    {% endif %}">
            <span class="w-3 h-3 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full animate-pulse"></span>
            Generate
          </a>
        </div>

        <!-- Lado derecho: Subt铆tulo + Theme toggle -->
        <div class="flex items-center gap-2">
          <span class="text-xs uppercase tracking-wide text-muted-foreground hidden md:inline">
            CLI + Web 路 JSON exams
          </span>
          <button id="theme-toggle" class="p-2 rounded-lg border border-border hover:bg-accent text-muted-foreground hover:text-foreground transition-all hover:shadow-sm" title="Toggle theme">
            <svg id="sun-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg id="moon-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="max-w-4xl mx-auto px-4 py-6">
        {% block content %}{% endblock %}
      </div>
    </main>

    <footer class="border-t border-border text-xs text-muted-foreground">
      <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
        <span>SmartQuiz 路 Local practice tool</span>
        <span>Built with FastAPI + Tailwind</span>
      </div>
    </footer>

    <!-- JAVASCRIPT COMPLETO -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const html = document.documentElement;
        const body = document.body;
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        
        let currentTheme = localStorage.getItem('theme') || 
                          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        
        function applyTheme(theme) {
          html.classList.remove('light', 'dark');
          body.classList.remove('light', 'dark');
          html.classList.add(theme);
          body.classList.add(theme);
          sunIcon.classList.toggle('hidden', theme !== 'light');
          moonIcon.classList.toggle('hidden', theme === 'light');
          localStorage.setItem('theme', theme);
        }
        
        applyTheme(currentTheme);
        themeToggle.addEventListener('click', () => {
          currentTheme = currentTheme === 'light' ? 'dark' : 'light';
          applyTheme(currentTheme);
        });

        // CONTADOR DINMICO DE EXAMENES COMPLETADOS
        async function updateCompletedCount() {
          try {
            const response = await fetch('/api/completed/count');
            if (!response.ok) return;
            const data = await response.json();
            const badge = document.getElementById('completed-badge');
            if (data.count > 0) {
              badge.textContent = data.count > 99 ? '99+' : data.count;
              badge.classList.remove('hidden');
            } else {
              badge.classList.add('hidden');
            }
          } catch (e) {}
        }
        updateCompletedCount();
        setInterval(updateCompletedCount, 30000);
      });
    </script>
  </body>
</html>
