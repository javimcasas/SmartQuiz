{% extends "base.html" %}

{% block title %}{{ exam.title }} Â· SmartQuiz{% endblock %}

{% block content %}
  <div class="mb-6">
    <a href="/" class="text-sm text-slate-400 hover:text-slate-200">&larr; Back to exams</a>
  </div>

  <div class="mb-6">
    <h1 class="text-2xl font-semibold tracking-tight">{{ exam.title }}</h1>
    <div class="mt-2 flex flex-wrap items-center gap-3 text-sm text-slate-400">
      {% if exam.description %}
        <p>{{ exam.description }}</p>
      {% endif %}
      {% if exam.difficulty %}
        <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium
                     {% if exam.difficulty == 'easy' %}
                       bg-emerald-500/10 text-emerald-300 border border-emerald-500/30
                     {% elif exam.difficulty == 'hard' %}
                       bg-rose-500/10 text-rose-300 border border-rose-500/30
                     {% else %}
                       bg-amber-500/10 text-amber-300 border border-amber-500/30
                     {% endif %}">
          {{ exam.difficulty|capitalize }}
        </span>
      {% endif %}
      <span class="text-xs uppercase tracking-wide text-slate-500">
        {{ exam.questions|length }} questions
      </span>
    </div>
  </div>

  <form method="post" class="space-y-4">
    {% for q in exam.questions %}
      {% set idx = loop.index0 %}
      <section class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 class="text-sm font-semibold text-slate-200">
              Q{{ loop.index }}
              <span class="ml-2 text-xs uppercase tracking-wide text-slate-500">
                {{ q.type }}
              </span>
            </h2>
            <p class="mt-1 text-sm text-slate-100">
              {{ q.question }}
            </p>
          </div>
        </div>

        <!-- ID estable -->
        <input type="hidden" name="q{{ idx }}_num" value="{{ q.number }}" />

        <div class="mt-3 space-y-2">
          {% if q.type in ["single", "true_false"] %}
            {% for opt in q.options %}
              <label class="flex items-center gap-2 text-sm text-slate-100 cursor-pointer">
                <input
                  type="radio"
                  name="q{{ idx }}"
                  value="{{ opt.value }}"
                  class="h-4 w-4 rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500"
                />
                <span>
                  <span class="font-mono text-xs text-slate-400">{{ opt.value }})</span>
                  {{ opt.text }}
                </span>
              </label>
            {% endfor %}

          {% elif q.type == "multiple" %}
            <p class="text-xs text-slate-400 mb-1">Select all that apply.</p>
            {% for opt in q.options %}
              <label class="flex items-center gap-2 text-sm text-slate-100 cursor-pointer">
                <input
                  type="checkbox"
                  name="q{{ idx }}_{{ opt.value }}"
                  class="h-4 w-4 rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500"
                />
                <span>
                  <span class="font-mono text-xs text-slate-400">{{ opt.value }})</span>
                  {{ opt.text }}
                </span>
              </label>
            {% endfor %}

          {% elif q.type == "fill_blank" %}
            <input
              type="text"
              name="q{{ idx }}"
              class="w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 placeholder-slate-500 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500"
              placeholder="Type your answer..."
            />
          {% endif %}
        </div>
      </section>
    {% endfor %}

    <div class="pt-2">
      <button
        type="submit"
        class="inline-flex items-center rounded-lg bg-sky-500 px-4 py-2 text-sm font-medium text-slate-900 hover:bg-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-900"
      >
        Submit exam
      </button>
    </div>
  </form>
{% endblock %}
